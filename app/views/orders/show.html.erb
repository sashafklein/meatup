<% provide(:title, 'Your Order') %>
<p id="notice"><%= notice %></p>

<% @a = @order.animalfind %>
<% status_array = ["Incomplete", "Deposited", "Final Price Paid", "Picked Up"] %>
<% @total = 0 %>
<% @total_weight = 0 %>

<table class="receipt_display">
<thead>
	<tr>
		<th colspan=5 class="header">
			<div class="receipt_stamp">
				<% if @order.status == 0 %>
				ORDER<br>REVIEW
				<% elsif @order.status == 1 %>
				DEPOSIT RECEIVED<br>WITH THANKS
				<% elsif @order.status == 2 %>
				FINAL BILL<br>FULLY PAID
				<% else %>
				FINAL<br>ORDER<br>RETREIVED
				<% end %>
			</div>
			<%= @a.ranch.address %>, <%= @a.ranch.city %>, <%= @a.ranch.state %>, <u>&nbsp;<%= localize(@order.created_at, :format => ("on %d, %B, %Y")) %>&nbsp;</u><br>
			<strong style="font-size:150%; font-weight:normal">Pay to order of <u style="font-weight:bold;">&nbsp;<%= @a.ranch.name %>&nbsp;,</u> c/o MeatUp</strong><br>
<!-- 			<u>&nbsp;<%= @order.user.name %>&nbsp;,</u> <%= "Order \##{@order.id}"%><br>
 -->			<div id="purveyor_of">
				Purveyor of<br><b>High Class Viandes, Game and Forcemeats</b>
			</div>
		</th>
	</tr>
</thead>
<tbody>
	<tr>
		<td colspan=4 class="divider">
		</td>
	</tr>
	<tr>
		<td colspan=4>
			Customer Name: <%= @order.user.name %>
		</td>
	</tr>
	<tr>
		<td colspan=4>
			Animal Name: <%= @a.name %>
		</td>
	</tr>
	<tr>
		<td colspan=4>
			Order Status: 
			<b style="font-weight:normal;color:#9a393a;"><%= status_array[@order.status] %></b>
		</td>
	</tr>
	<tr>
		<td colspan=4 class="divider2">
		</td>
	</tr>
	<tr>
		<th class="details">Cut</th>
		<th class="details">Notes</th>
		<th class="details" width=15%>Total Lbs</th>
		<th class="details" width=15%>Price</th>
	</tr>

	<% @order.lines.each do |l| %>
		<% if l.units != 0 %>
			<% @c = l.cut %>
			<% show_helper %>
			<tr>	
			    	<td><%= @c.name %></td>
			    	<td><%= l.notes %></td>
			    	<td><%= @c.package_weight * l.units %> lb</td>
			    	<% @line_total = @example.price * @c.package_weight * l.units %>
			    	<td><%= number_to_currency(@line_total) %></td>
			    	<% @total_weight += @c.package_weight * l.units %>
		    </tr>
		    <% @total += @line_total %>
		<% end %>
	<%end%>

	<% @order.total = @total %>
	<tr>
		<td></td>
		<td></td>
		<td><strong><%= @total_weight %> lb</strong></td>
		<td><b><%= number_to_currency(@total) %><b></td>
	</tr>
	<tr>
		<td colspan=4 class="spacer">
			<div class="receipt_pay">
				<%= form_tag charges_path do %>
				  <script src="https://button.stripe.com/v1/button.js" 
				  		class="stripe-button"
				        data-key="<%= Rails.configuration.stripe[:publishable_key] %>"
				        data-description="<%= @order.animal.name %>"
				        data-amount="<%= @order.total * 100 %>"></script>
				<% end %>
			</div>
		</td>
	</tr>
	</tbody>
</table>
<div class="receipt_notes">
	<% @h = @a.host %>
	This order represents a hold of estimate size (<%= @total_weight %> lbs), placed on <%= @a.name %>, a <%= @a.weight %> lb <%= @a.breed %> <%= @a.animal_type %>, raised sustainably on <%= @a.ranch.name %>, in <%= @a.ranch.city %>, <%= @a.ranch.state %>.  MeatUp and <%= @a.ranch.name %> reserve the right to automatically adjust the final poundage of your order to match actual weight and availability, within a variance of EXPECTED VARIANCE.  As part of this order, you agree to be charged or refunded the difference between this estimate and the final poundage at the price-per-pound of this order.  Once confirmed and delivered, the meat will be available at <%= link_to "your host", host_path(@h) %>'s' for pickup over a period of no more than 24 hours.  As a customer, you are responsible for organizing a timely pick-up of your order, and if you are not personally able to retrieve your order during the pickup window, please contact your host, <%= @h.user.name %>, to make special arrangements.  Neither MeatUp, nor <%= @a.ranch.name %>, nor <%= @h.user.name %> is responsible for any damage that may occur to the contents of your order if it is retrieved outside of the established pickup window.
</div>